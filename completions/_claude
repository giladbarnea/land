#compdef claude
# Created 2026-01-27

_claude() {
  local curcontext="$curcontext" state line
  local -i ret=1
  typeset -A opt_args

  local -a main_options=(
    '--add-dir[Additional directories to allow tool access to]:directory:_files -/'
    '--agent[Agent for the current session]:agent:'
    '--agents[JSON object defining custom agents]:json:'
    '--allow-dangerously-skip-permissions[Enable bypassing permission checks as an option]'
    '--allowedTools[Comma or space-separated list of tool names to allow]:tools:'
    '--allowed-tools[Comma or space-separated list of tool names to allow]:tools:'
    '--append-system-prompt[Append a system prompt to the default]:prompt:'
    '--betas[Beta headers to include in API requests]:betas:'
    '--chrome[Enable Claude in Chrome integration]'
    '(-c --continue)'{-c,--continue}'[Continue the most recent conversation in the current directory]'
    '--dangerously-skip-permissions[Bypass all permission checks]'
    '(-d --debug)'{-d,--debug}'[Enable debug mode with optional category filtering]:filter:'
    '--disable-slash-commands[Disable all skills]'
    '--disallowedTools[Comma or space-separated list of tool names to deny]:tools:'
    '--disallowed-tools[Comma or space-separated list of tool names to deny]:tools:'
    '--fallback-model[Enable automatic fallback to specified model]:model:(sonnet opus haiku)'
    '--file[File resources to download at startup]:specs:'
    '--fork-session[Create a new session ID when resuming]'
    '(-h --help)'{-h,--help}'[Display help for command]'
    '--ide[Automatically connect to IDE on startup]'
    '--include-partial-messages[Include partial message chunks as they arrive]'
    '--input-format[Input format]:format:(text stream-json)'
    '--json-schema[JSON Schema for structured output validation]:schema:'
    '--max-budget-usd[Maximum dollar amount to spend on API calls]:amount:'
    '--mcp-config[Load MCP servers from JSON files or strings]:configs:'
    '--mcp-debug[Enable MCP debug mode]'
    '--model[Model for the current session]:model:(sonnet opus haiku)'
    '--no-chrome[Disable Claude in Chrome integration]'
    '--no-session-persistence[Disable session persistence]'
    '--output-format[Output format]:format:(text json stream-json)'
    '--permission-mode[Permission mode to use for the session]:mode:(acceptEdits bypassPermissions default delegate dontAsk plan)'
    '--plugin-dir[Load plugins from directories for this session only]:path:_files -/'
    '(-p --print)'{-p,--print}'[Print response and exit]'
    '--replay-user-messages[Re-emit user messages from stdin]'
    '(-r --resume)'{-r,--resume}'[Resume a conversation by session ID]:value:'
    '--session-id[Use a specific session ID]:uuid:'
    '--setting-sources[Comma-separated list of setting sources]:sources:'
    '--settings[Path to a settings JSON file or a JSON string]:file-or-json:_files'
    '--strict-mcp-config[Only use MCP servers from --mcp-config]'
    '--system-prompt[System prompt to use for the session]:prompt:'
    '--tools[Specify the list of available tools]:tools:'
    '--verbose[Override verbose mode setting from config]'
    '(-v --version)'{-v,--version}'[Output the version number]'
  )

  local -a subcommands=(
    'doctor:Check the health of your Claude Code auto-updater'
    'install:Install Claude Code native build'
    'mcp:Configure and manage MCP servers'
    'plugin:Manage Claude Code plugins'
    'setup-token:Set up a long-lived authentication token'
    'update:Check for updates and install if available'
  )

  _arguments -C \
    $main_options \
    '1: :->subcommand' \
    '*:: :->args' && ret=0

  case $state in
    (subcommand)
      _describe -t subcommands 'claude subcommands' subcommands && ret=0
      ;;
    (args)
      case "${words[1]}" in
        (doctor)
          _message "no arguments"
          ret=0
          ;;
        (install)
          _claude:install
          ret=$?
          ;;
        (mcp)
          _claude:mcp
          ret=$?
          ;;
        (plugin)
          _claude:plugin
          ret=$?
          ;;
        (setup-token)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' && ret=0
          ;;
        (update)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' && ret=0
          ;;
        (*)
          ret=0
          ;;
      esac
      ;;
  esac

  return $ret
}

_claude:install() {
  _arguments \
    '--force[Force installation even if already installed]' \
    '(-h --help)'{-h,--help}'[Display help for command]' \
    '1:target:(stable latest)' && return 0
}

_claude:mcp() {
  local -a mcp_subcommands=(
    'add:Add an MCP server to Claude Code'
    'add-from-claude-desktop:Import MCP servers from Claude Desktop'
    'add-json:Add an MCP server with a JSON string'
    'get:Get details about an MCP server'
    'help:Display help for command'
    'list:List configured MCP servers'
    'remove:Remove an MCP server'
    'reset-project-choices:Reset all approved and rejected project-scoped servers'
    'serve:Start the Claude Code MCP server'
  )

  _arguments -C \
    '1: :->mcp_subcommand' \
    '*:: :->mcp_args' && ret=0

  case ${state} in
    (mcp_subcommand)
      _describe -t subcommands 'mcp subcommands' mcp_subcommands && ret=0
      ;;
    (mcp_args)
      case ${words[1]} in
        (add)
          _arguments \
            '--transport[Transport type]:transport:(http stdio)' \
            '--header[HTTP headers]:header:' \
            '-e[Environment variables]:env:' \
            '1:name:' \
            '2:commandOrUrl:' \
            '*:args:' && ret=0
          ;;
        (add-from-claude-desktop)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' && ret=0
          ;;
        (add-json)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '1:name:' \
            '2:json:' && ret=0
          ;;
        (get)
          _arguments \
            '1:name:' && ret=0
          ;;
        (list)
          _message "no arguments"
          ret=0
          ;;
        (remove)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '1:name:' && ret=0
          ;;
        (reset-project-choices)
          _message "no arguments"
          ret=0
          ;;
        (serve)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' && ret=0
          ;;
        (help)
          _describe -t subcommands 'mcp subcommands' mcp_subcommands && ret=0
          ;;
        (*)
          _message "argument for ${words[1]}"
          ;;
      esac
      ;;
  esac
}

_claude:plugin() {
  local -a plugin_subcommands=(
    'disable:Disable an enabled plugin'
    'enable:Enable a disabled plugin'
    'install:Install a plugin from available marketplaces'
    'i:Install a plugin from available marketplaces'
    'list:List installed plugins'
    'marketplace:Manage Claude Code marketplaces'
    'uninstall:Uninstall an installed plugin'
    'remove:Uninstall an installed plugin'
    'update:Update a plugin to the latest version'
    'validate:Validate a plugin or marketplace manifest'
  )

  _arguments -C \
    '1: :->plugin_subcommand' \
    '*:: :->plugin_args' && ret=0

  case ${state} in
    (plugin_subcommand)
      _describe -t subcommands 'plugin subcommands' plugin_subcommands && ret=0
      ;;
    (plugin_args)
      case ${words[1]} in
        (disable|enable)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '(-s --scope)'{-s,--scope}'[Installation scope]:scope:(user project local)' \
            '1:plugin:' && ret=0
          ;;
        (install|i)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '(-s --scope)'{-s,--scope}'[Installation scope]:scope:(user project local)' \
            '1:plugin:' && ret=0
          ;;
        (list)
          _arguments \
            '--available[Include available plugins from marketplaces]' \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '--json[Output as JSON]' && ret=0
          ;;
        (marketplace)
          _claude:plugin:marketplace
          ret=$?
          ;;
        (uninstall|remove)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '(-s --scope)'{-s,--scope}'[Uninstall from scope]:scope:(user project local)' \
            '1:plugin:' && ret=0
          ;;
        (update)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '(-s --scope)'{-s,--scope}'[Installation scope]:scope:(user project local managed)' \
            '1:plugin:' && ret=0
          ;;
        (validate)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '1:path:_files' && ret=0
          ;;
        (*)
          _message "argument for ${words[1]}"
          ;;
      esac
      ;;
  esac
}

_claude:plugin:marketplace() {
  local -a marketplace_subcommands=(
    'add:Add a marketplace from a URL, path, or GitHub repo'
    'help:Display help for command'
    'list:List all configured marketplaces'
    'remove:Remove a configured marketplace'
    'rm:Remove a configured marketplace'
    'update:Update marketplace(s) from their source'
  )

  _arguments -C \
    '1: :->marketplace_subcommand' \
    '*:: :->marketplace_args' && ret=0

  case ${state} in
    (marketplace_subcommand)
      _describe -t subcommands 'marketplace subcommands' marketplace_subcommands && ret=0
      ;;
    (marketplace_args)
      case ${words[1]} in
        (add)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '1:source:' && ret=0
          ;;
        (list)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '--json[Output as JSON]' && ret=0
          ;;
        (remove|rm)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '1:name:' && ret=0
          ;;
        (update)
          _arguments \
            '(-h --help)'{-h,--help}'[Display help for command]' \
            '::name:' && ret=0
          ;;
        (help)
          _describe -t subcommands 'marketplace subcommands' marketplace_subcommands && ret=0
          ;;
        (*)
          _message "argument for ${words[1]}"
          ;;
      esac
      ;;
  esac
}

if [ "${funcstack[1]}" = "_claude" ]; then
    _claude "$@"
else
    compdef _claude claude
fi
